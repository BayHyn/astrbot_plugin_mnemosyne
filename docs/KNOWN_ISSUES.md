# å·²çŸ¥é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## ğŸš¨ ç¬¬ä¸‰æ–¹åº“è­¦å‘Š

### pymilvus pkg_resources å¼ƒç”¨è­¦å‘Š

**é—®é¢˜æè¿°:**
```
UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
```

**åŸå› åˆ†æ:**
- `pymilvus` åº“å†…éƒ¨ä½¿ç”¨äº†å·²å¼ƒç”¨çš„ `pkg_resources` æ¨¡å—
- è¿™æ˜¯ `pymilvus` åº“æœ¬èº«çš„é—®é¢˜ï¼Œä¸æ˜¯æ’ä»¶ä»£ç é—®é¢˜
- `pkg_resources` è®¡åˆ’åœ¨ 2025-11-30 ç§»é™¤

**å½±å“ç¨‹åº¦:**
- âš ï¸ **ä»…ä¸ºè­¦å‘Š**: ä¸å½±å“åŠŸèƒ½æ­£å¸¸ä½¿ç”¨
- ğŸ”„ **ä¸´æ—¶æ€§é—®é¢˜**: ç­‰å¾… `pymilvus` åº“æ›´æ–°ä¿®å¤
- ğŸ“… **é¢„è®¡è§£å†³**: pymilvus å›¢é˜Ÿä¼šåœ¨æœªæ¥ç‰ˆæœ¬ä¸­ä¿®å¤

**è§£å†³æ–¹æ¡ˆ:**

#### æ–¹æ¡ˆ1: è‡ªåŠ¨æŠ‘åˆ¶ï¼ˆå·²å®ç°ï¼‰
æ’ä»¶å·²è‡ªåŠ¨æŠ‘åˆ¶æ­¤è­¦å‘Šï¼Œæ— éœ€ç”¨æˆ·æ“ä½œã€‚

#### æ–¹æ¡ˆ2: æ‰‹åŠ¨å›ºå®šç‰ˆæœ¬
å¦‚æœä»ç„¶çœ‹åˆ°è­¦å‘Šï¼Œå¯ä»¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œï¼š
```bash
pip install "setuptools<81"
```

#### æ–¹æ¡ˆ3: å¿½ç•¥è­¦å‘Š
è¿™æ˜¯ä¸€ä¸ªå·²çŸ¥çš„æ— å®³è­¦å‘Šï¼Œå¯ä»¥å®‰å…¨å¿½ç•¥ã€‚

**ç›‘æ§çŠ¶æ€:**
- âœ… æ’ä»¶å·²å®ç°è‡ªåŠ¨è­¦å‘Šè¿‡æ»¤
- ğŸ” æŒç»­å…³æ³¨ pymilvus åº“æ›´æ–°
- ğŸ“‹ å°†åœ¨ pymilvus ä¿®å¤åç§»é™¤è­¦å‘Šè¿‡æ»¤å™¨

## ğŸ”§ å…¶ä»–å·²çŸ¥é—®é¢˜

### ç«¯å£å ç”¨é—®é¢˜

**é—®é¢˜æè¿°:**
```
ERROR: [Errno 10048] error while attempting to bind on address ('127.0.0.1', 8765): é€šå¸¸æ¯ä¸ªå¥—æ¥å­—åœ°å€(åè®®/ç½‘ç»œåœ°å€/ç«¯å£)åªå…è®¸ä½¿ç”¨ä¸€æ¬¡ã€‚
```

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²å®ç°è‡ªåŠ¨ç«¯å£é€‰æ‹©
- ğŸ› ï¸ ä½¿ç”¨ `/memory web_cleanup` æ¸…ç†èµ„æº
- âš™ï¸ åœ¨é…ç½®ä¸­å¯ç”¨ `auto_port_selection: true`

### é‡å¯åä»¤ç‰Œä¸¢å¤±

**é—®é¢˜æè¿°:**
é‡å¯ AstrBot åï¼ŒWeb ç•Œé¢è®¿é—®ä»¤ç‰Œä¸æ˜¾ç¤ºã€‚

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²ä¿®å¤ï¼šæ¯æ¬¡å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆæ–°ä»¤ç‰Œ
- ğŸ“‹ ä½¿ç”¨ `/memory web_status` æŸ¥çœ‹å½“å‰ä»¤ç‰Œ
- ğŸ”§ å¯åœ¨é…ç½®ä¸­è®¾ç½®å›ºå®šä»¤ç‰Œ

### Web API å‚æ•°é”™è¯¯

**é—®é¢˜æè¿°:**
```
åŠ è½½è®°å¿†æ•°æ®å¤±è´¥: è·å–è®°å¿†æ•°æ®å¤±è´¥: MilvusManager.query() missing 1 required positional argument: 'expression'
```

**åŸå› åˆ†æ:**
- Webç•Œé¢ä»£ç ä¸­ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°å `filters`
- Milvus å‘é‡æ•°æ®åº“çš„ `query` å’Œ `delete` æ–¹æ³•éœ€è¦ `expression` å‚æ•°

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²ä¿®å¤ï¼šå°†æ‰€æœ‰ `filters` å‚æ•°æ”¹ä¸º `expression`
- ğŸ”§ å½±å“çš„æ–¹æ³•ï¼š`query()` å’Œ `delete()`
- ğŸ“‹ ä¿®å¤æ–‡ä»¶ï¼š`web_interface/web_server.py`

### Web API NoneType é”™è¯¯

**é—®é¢˜æè¿°:**
```
åŠ è½½è®°å¿†æ•°æ®å¤±è´¥: è·å–è®°å¿†æ•°æ®å¤±è´¥: object of type 'NoneType' has no len()
```

**åŸå› åˆ†æ:**
- `vector_db.query()` æ–¹æ³•è¿”å› `None`
- ä»£ç ç›´æ¥å¯¹ `None` è°ƒç”¨ `len()` å‡½æ•°å¯¼è‡´é”™è¯¯
- å¯èƒ½åŸå› ï¼šæ•°æ®åº“è¿æ¥é—®é¢˜ã€é›†åˆä¸å­˜åœ¨ã€é›†åˆä¸ºç©º

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²ä¿®å¤ï¼šæ·»åŠ  `None` å€¼æ£€æŸ¥å’Œå¤„ç†
- ğŸ”§ è¿”å›ç©ºåˆ—è¡¨ `[]` æ›¿ä»£ `None`
- ğŸ“‹ å¢å¼ºé”™è¯¯æ—¥å¿—å’Œè¯Šæ–­ä¿¡æ¯
- ğŸ› ï¸ æ·»åŠ æ•°æ®åº“çŠ¶æ€æ£€æŸ¥åŠŸèƒ½

## ğŸ“Š é—®é¢˜æŠ¥å‘Š

å¦‚æœé‡åˆ°æ–°çš„é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **é”™è¯¯ä¿¡æ¯**: å®Œæ•´çš„é”™è¯¯æ—¥å¿—
2. **ç¯å¢ƒä¿¡æ¯**: Python ç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿ
3. **é…ç½®ä¿¡æ¯**: ç›¸å…³çš„é…ç½®è®¾ç½®
4. **é‡ç°æ­¥éª¤**: å¦‚ä½•é‡ç°é—®é¢˜

## ğŸ”„ æ›´æ–°æ—¥å¿—

### v0.6.0
- âœ… ä¿®å¤ç«¯å£å ç”¨é—®é¢˜
- âœ… ä¿®å¤é‡å¯åä»¤ç‰Œä¸¢å¤±é—®é¢˜
- âœ… æ·»åŠ  pymilvus è­¦å‘Šè¿‡æ»¤å™¨
- âœ… å®ç°è‡ªåŠ¨åœæ­¢åŠŸèƒ½
- âœ… ä¿®å¤ Web API å‚æ•°é”™è¯¯ï¼ˆfilters â†’ expressionï¼‰
- âœ… ä¿®å¤ Web API NoneType é”™è¯¯ï¼ˆæ·»åŠ ç©ºå€¼æ£€æŸ¥ï¼‰
- âœ… ä¿®å¤ Milvus è¿ç§»è„šæœ¬é—®é¢˜ï¼ˆSchemaå…¼å®¹æ€§å’Œæ•°æ®æ ¼å¼ï¼‰
- âœ… å¢å¼ºè¿ç§»è¿›åº¦æ˜¾ç¤ºå’Œé”™è¯¯å¤„ç†ï¼ˆè¯¦ç»†æ—¥å¿—å’Œå…¼å®¹æ€§æ£€æŸ¥ï¼‰
- âœ… å®ç°å¼‚æ­¥è¿ç§»åŠŸèƒ½ï¼ˆä½¿ç”¨ asyncio.create_task æ›¿ä»£ run_in_executorï¼‰

### Milvus è¿ç§»è„šæœ¬é—®é¢˜

**é—®é¢˜æè¿°:**
- Schemaä¸å…¼å®¹ï¼šMilvuséœ€è¦CollectionSchemaå¯¹è±¡ï¼Œä½†è¿ç§»è„šæœ¬ä¼ é€’å­—å…¸
- æ•°æ®æ ¼å¼é—®é¢˜ï¼šç¼ºå°‘æ•°æ®ç±»å‹éªŒè¯å’Œè½¬æ¢
- ç´¢å¼•ç¼ºå¤±ï¼šè¿ç§»åé›†åˆæ— æ³•æ­£å¸¸æœç´¢

**åŸå› åˆ†æ:**
- è¿ç§»è„šæœ¬ä½¿ç”¨ç®€åŒ–çš„schemaæ ¼å¼
- ä¸åŒæ•°æ®åº“çš„æ•°æ®æ ¼å¼è¦æ±‚ä¸åŒ
- ç¼ºå°‘å®Œæ•´çš„schemaå®šä¹‰å’Œç´¢å¼•åˆ›å»º

**è§£å†³æ–¹æ¡ˆ:**
- âœ… å·²ä¿®å¤ï¼šä¸ºMilvusåˆ›å»ºæ­£ç¡®çš„CollectionSchema
- âœ… æ·»åŠ æ•°æ®æ ¼å¼éªŒè¯å’Œè½¬æ¢é€»è¾‘
- âœ… è‡ªåŠ¨åˆ›å»ºå‘é‡ç´¢å¼•
- âœ… å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- ğŸ§ª æä¾›è¿ç§»æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šéšç€é—®é¢˜çš„è§£å†³å’Œæ–°é—®é¢˜çš„å‘ç°è€Œæ›´æ–°ã€‚
